#include <SPI.h>
#include <avr/pgmspace.h>
#include "Ucglib.h"
#include "URTouch.h"

// -= LCD INIT =-
// Arduino pins                  (UNO / Mega2560) (mega2560)
#define LCD_CS 8      // CS             8
#define LCD_RST 10    // RESET          10
#define LCD_DC 9      // D/C            9
#define LCD_SDI 11    // SDI(MOSI)      11            51
#define LCD_CLK 13    // SCK            13            52
//#define LCD_SDO 12  // SDO(MISO)      12            50

Ucglib_ILI9341_18x240x320_SWSPI ucg(LCD_CLK, LCD_SDI, LCD_DC, LCD_CS, LCD_RST);
//Ucglib_ILI9341_18x240x320_HWSPI ucg(LCD_DC, LCD_CS, LCD_RST); // HWSPI does not work in UCGLIB library
// -= LCD INIT =-

// -= TOUCH SCREEN INIT =-
// Arduino pins
#define t_SCK 3   // T_CLK
#define t_CS 4    // T_CS
#define t_DIN 5   // T_DIN  (MOSI)
#define T_DOUT 6  // T_DO   (MISO)
#define t_IRQ 7   // T_IRQ

URTouch urt(t_SCK, t_CS, t_DIN, T_DOUT, t_IRQ);

int xp_cal = 2, xm_cal = 0;   // X +/- calibration
int yp_cal = 0, ym_cal = 14;  // Y +/- calibration
// -= TOUCH SCREEN INIT =-

int x, y, xt, yt;
int mode = 1;
int ScrW = 240;
int ScrH = 320;

void cal_x(){ x += xp_cal; x -= xm_cal; }
void cal_y(){ y += yp_cal; y -= ym_cal; }
void cal_xy(){ cal_x(); cal_y(); }

// Chimbalix_Logo 64x64px
const unsigned char Chimbalix_Logo[64][64] PROGMEM = {
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 187, 230, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 231, 187, 125, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 177, 255, 255, 254, 255, 254, 254, 255, 254, 255, 255, 254, 254, 255, 254, 255, 254, 255, 255, 177, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 230, 255, 255, 254, 254, 254, 255, 255, 254, 254, 255, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 255, 255, 230, 125, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 124, 231, 255, 254, 255, 254, 254, 255, 255, 254, 254, 255, 255, 254, 254, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 255, 255, 255, 230, 125, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 237, 255, 254, 254, 255, 255, 254, 254, 255, 254, 255, 255, 254, 254, 255, 255, 254, 255, 254, 255, 254, 254, 255, 254, 255, 254, 255, 254, 255, 255, 255, 237, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 105, 255, 253, 255, 254, 255, 254, 255, 255, 254, 255, 255, 254, 254, 255, 255, 254, 254, 255, 254, 254, 255, 254, 255, 254, 254, 254, 255, 254, 255, 254, 254, 255, 254, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 254, 255, 255, 254, 254, 254, 255, 254, 254, 254, 255, 254, 255, 254, 254, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 255, 255, 254, 254, 255, 254, 254, 254, 255, 105, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 255, 254, 255, 254, 255, 254, 255, 254, 255, 255, 255, 254, 255, 255, 254, 255, 255, 254, 255, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 254, 254, 254, 255, 254, 255, 254, 255, 104, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 254, 255, 254, 254, 255, 255, 254, 255, 254, 255, 254, 255, 255, 255, 255, 178, 187, 187, 187, 187, 178, 255, 255, 255, 254, 254, 255, 255, 254, 254, 255, 254, 254, 255, 254, 254, 255, 255, 185, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 255, 254, 254, 255, 255, 254, 254, 254, 255, 254, 255, 253, 255, 178, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 124, 178, 255, 254, 254, 255, 254, 255, 254, 254, 255, 255, 254, 254, 254, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 255, 254, 255, 255, 254, 254, 255, 254, 254, 255, 254, 255, 187, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 187, 255, 253, 255, 254, 255, 255, 254, 254, 255, 254, 255, 186, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 254, 255, 254, 254, 254, 255, 255, 254, 254, 255, 255, 187, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 187, 255, 254, 254, 254, 255, 255, 254, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 237, 254, 254, 255, 254, 254, 254, 255, 255, 255, 254, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 104, 255, 254, 254, 255, 255, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 125, 255, 254, 255, 254, 255, 255, 255, 254, 255, 253, 232, 122, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 24, 0, 22, 0, 0, 0, 0, 0, 0, 0, 0, 0, 121, 232, 254, 254, 255, 104, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 230, 255, 254, 255, 255, 254, 254, 254, 255, 254, 231, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 31, 36, 37, 39, 40, 39, 36, 33, 30, 0, 0, 0, 0, 0, 0, 0, 0, 0, 237, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 125, 255, 254, 255, 254, 254, 254, 255, 255, 254, 255, 122, 0, 0, 0, 0, 0, 0, 0, 0, 36, 41, 47, 51, 53, 54, 54, 55, 52, 50, 43, 39, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 230, 254, 255, 254, 254, 254, 254, 255, 254, 255, 104, 0, 0, 0, 0, 0, 0, 0, 34, 43, 50, 55, 61, 65, 68, 71, 70, 69, 68, 63, 59, 53, 47, 38, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 124, 255, 255, 254, 254, 255, 255, 254, 254, 254, 187, 0, 0, 0, 0, 0, 0, 0, 37, 48, 55, 63, 71, 76, 82, 84, 87, 86, 86, 84, 79, 74, 69, 60, 51, 42, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 178, 254, 254, 254, 255, 254, 255, 254, 254, 255, 0, 0, 0, 0, 0, 0, 0, 38, 49, 60, 70, 77, 85, 91, 96, 99, 102, 103, 100, 97, 93, 88, 81, 74, 65, 54, 45, 33, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 255, 255, 254, 254, 255, 254, 254, 255, 253, 188, 0, 0, 0, 0, 0, 0, 37, 49, 60, 71, 81, 91, 99, 106, 112, 116, 117, 118, 116, 114, 110, 102, 96, 85, 77, 69, 55, 43, 31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 124, 255, 254, 254, 255, 254, 254, 254, 255, 255, 0, 0, 0, 0, 0, 0, 35, 48, 59, 72, 82, 94, 103, 113, 120, 125, 129, 131, 132, 132, 128, 123, 117, 107, 99, 89, 77, 66, 53, 42, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 187, 254, 255, 255, 254, 254, 254, 255, 254, 177, 0, 0, 0, 0, 0, 0, 43, 55, 69, 81, 94, 104, 116, 126, 133, 140, 146, 147, 148, 148, 143, 135, 129, 120, 110, 99, 87, 76, 63, 49, 35, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 230, 254, 254, 255, 254, 255, 255, 254, 255, 125, 0, 0, 0, 0, 0, 36, 50, 63, 78, 91, 104, 115, 126, 137, 147, 155, 160, 164, 164, 160, 158, 151, 142, 132, 122, 109, 98, 83, 70, 57, 43, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 254, 254, 255, 254, 254, 255, 254, 255, 0, 0, 0, 0, 0, 0, 41, 56, 72, 85, 99, 113, 125, 137, 181, 213, 216, 218, 220, 221, 219, 217, 219, 147, 144, 131, 119, 105, 92, 78, 63, 49, 34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 255, 254, 254, 254, 255, 254, 254, 255, 0, 0, 0, 0, 0, 31, 47, 62, 76, 91, 106, 120, 133, 148, 213, 254, 254, 255, 254, 255, 254, 254, 255, 154, 153, 141, 127, 113, 99, 83, 70, 54, 40, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 255, 255, 254, 255, 254, 254, 255, 177, 0, 0, 0, 0, 0, 36, 51, 65, 82, 95, 112, 125, 140, 155, 216, 254, 255, 254, 255, 255, 254, 255, 255, 167, 160, 147, 133, 118, 103, 89, 73, 58, 43, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 254, 255, 254, 254, 254, 254, 255, 187, 0, 0, 0, 0, 0, 37, 54, 69, 83, 100, 116, 131, 144, 160, 219, 255, 254, 254, 254, 254, 255, 254, 255, 174, 167, 153, 137, 123, 108, 91, 76, 61, 46, 30, 0, 0, 0, 0, 0, 0, 0, 196, 187, 187, 122, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 255, 254, 254, 255, 255, 254, 255, 187, 0, 0, 0, 0, 0, 39, 54, 70, 87, 101, 117, 132, 148, 163, 221, 254, 254, 255, 254, 255, 254, 254, 255, 180, 171, 156, 140, 124, 109, 94, 79, 63, 46, 31, 0, 0, 0, 0, 0, 104, 255, 254, 254, 255, 255, 186, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 254, 254, 255, 254, 254, 254, 254, 188, 0, 0, 0, 0, 0, 40, 54, 70, 87, 103, 118, 132, 149, 164, 221, 254, 254, 255, 255, 254, 254, 255, 255, 181, 172, 156, 139, 125, 111, 95, 79, 62, 46, 33, 0, 0, 0, 0, 121, 255, 254, 255, 255, 255, 254, 255, 124, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 254, 255, 254, 255, 254, 254, 255, 187, 0, 0, 0, 0, 0, 38, 55, 69, 85, 101, 117, 132, 146, 161, 219, 255, 254, 254, 254, 255, 254, 254, 255, 178, 170, 154, 140, 124, 108, 93, 77, 62, 47, 30, 0, 0, 0, 0, 188, 254, 255, 254, 254, 254, 255, 254, 187, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 255, 255, 254, 254, 255, 254, 254, 178, 0, 0, 0, 0, 0, 36, 52, 69, 83, 97, 114, 128, 143, 158, 218, 254, 255, 254, 255, 254, 254, 255, 255, 171, 164, 151, 136, 121, 105, 90, 76, 59, 44, 0, 0, 0, 0, 0, 187, 255, 254, 254, 254, 255, 255, 254, 187, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 254, 254, 255, 254, 254, 255, 255, 255, 0, 0, 0, 0, 0, 34, 50, 63, 79, 93, 109, 123, 137, 151, 215, 254, 255, 254, 255, 255, 255, 254, 255, 160, 157, 144, 129, 116, 102, 86, 71, 57, 41, 0, 0, 0, 0, 0, 187, 255, 254, 255, 255, 254, 254, 254, 187, 0, 0, 0, 0}, 
{0, 0, 0, 0, 255, 255, 254, 254, 255, 255, 254, 254, 255, 0, 0, 0, 0, 0, 0, 44, 60, 74, 87, 103, 117, 129, 142, 212, 254, 254, 255, 255, 254, 255, 255, 255, 149, 148, 136, 123, 109, 95, 81, 66, 51, 37, 0, 0, 0, 0, 0, 197, 253, 255, 255, 254, 254, 254, 253, 196, 0, 0, 0, 0}, 
{0, 0, 0, 0, 230, 255, 254, 254, 254, 254, 254, 254, 255, 125, 0, 0, 0, 0, 0, 39, 53, 69, 82, 95, 108, 121, 132, 208, 255, 254, 255, 254, 254, 255, 255, 255, 134, 138, 126, 115, 101, 89, 75, 61, 45, 31, 0, 0, 0, 0, 0, 0, 239, 254, 254, 255, 255, 254, 255, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 187, 254, 254, 255, 254, 255, 255, 254, 254, 177, 0, 0, 0, 0, 0, 33, 46, 60, 73, 86, 99, 111, 122, 205, 255, 255, 254, 254, 255, 254, 254, 255, 115, 126, 117, 104, 93, 79, 66, 54, 40, 0, 0, 0, 0, 0, 0, 0, 0, 187, 255, 255, 255, 237, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 124, 255, 254, 254, 255, 254, 255, 255, 254, 255, 0, 0, 0, 0, 0, 0, 39, 51, 65, 76, 89, 99, 110, 202, 255, 254, 255, 255, 254, 254, 254, 255, 100, 114, 104, 95, 82, 71, 58, 45, 31, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 255, 255, 254, 255, 254, 255, 254, 255, 254, 187, 0, 0, 0, 0, 0, 30, 42, 55, 69, 77, 88, 98, 199, 255, 255, 255, 255, 255, 255, 255, 255, 78, 102, 92, 83, 73, 61, 48, 37, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 178, 254, 254, 254, 255, 254, 255, 254, 254, 255, 0, 0, 0, 0, 0, 0, 32, 45, 55, 65, 76, 84, 196, 255, 255, 255, 255, 255, 255, 255, 255, 50, 89, 79, 70, 61, 51, 39, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 124, 255, 255, 254, 255, 255, 254, 254, 255, 253, 187, 0, 0, 0, 0, 0, 0, 33, 43, 54, 63, 70, 194, 255, 255, 255, 255, 255, 255, 255, 255, 80, 75, 69, 57, 49, 38, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 231, 254, 254, 255, 254, 254, 254, 254, 255, 255, 103, 0, 0, 0, 0, 0, 0, 31, 42, 50, 57, 192, 255, 255, 255, 255, 255, 255, 255, 255, 70, 61, 53, 46, 36, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 124, 255, 255, 255, 254, 254, 255, 254, 254, 255, 255, 122, 0, 0, 0, 0, 0, 0, 0, 35, 43, 190, 255, 255, 255, 255, 255, 255, 255, 255, 55, 45, 39, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 231, 254, 254, 255, 254, 255, 254, 254, 255, 255, 231, 0, 0, 0, 0, 0, 0, 0, 0, 0, 189, 255, 255, 255, 255, 255, 255, 255, 255, 45, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 125, 255, 255, 254, 255, 254, 255, 255, 254, 254, 254, 232, 122, 0, 0, 0, 0, 0, 0, 0, 188, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 237, 254, 254, 255, 254, 254, 254, 255, 255, 254, 254, 255, 104, 0, 0, 0, 0, 0, 0, 188, 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 254, 255, 254, 254, 254, 255, 255, 255, 254, 254, 255, 187, 0, 0, 0, 0, 0, 187, 255, 254, 255, 255, 254, 255, 254, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 255, 255, 255, 254, 255, 254, 255, 255, 254, 254, 255, 187, 0, 0, 0, 187, 255, 255, 254, 254, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 254, 254, 255, 254, 255, 254, 255, 254, 255, 255, 253, 255, 178, 125, 180, 254, 254, 255, 255, 254, 254, 254, 255, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 255, 255, 254, 254, 254, 255, 254, 255, 254, 254, 255, 255, 254, 255, 255, 255, 254, 255, 255, 255, 254, 254, 255, 180, 187, 188, 187, 187, 187, 187, 187, 187, 187, 188, 187, 187, 187, 187, 137, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 254, 255, 254, 254, 255, 254, 255, 255, 254, 254, 255, 255, 254, 254, 254, 255, 254, 255, 254, 254, 254, 254, 255, 254, 255, 254, 254, 255, 121, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 103, 255, 254, 254, 254, 254, 254, 255, 254, 255, 255, 254, 255, 254, 254, 254, 254, 254, 255, 255, 254, 254, 254, 254, 254, 254, 255, 254, 254, 255, 255, 254, 254, 255, 254, 254, 255, 103, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 105, 255, 253, 255, 255, 254, 254, 254, 255, 254, 254, 254, 255, 254, 255, 254, 255, 254, 255, 254, 255, 255, 254, 255, 254, 254, 254, 255, 254, 255, 254, 254, 254, 253, 255, 104, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 237, 255, 255, 255, 254, 255, 254, 255, 254, 255, 254, 254, 254, 255, 254, 254, 254, 255, 254, 254, 255, 254, 255, 254, 254, 255, 254, 254, 255, 254, 255, 237, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 230, 255, 255, 255, 254, 254, 255, 254, 255, 254, 254, 254, 255, 255, 254, 254, 255, 254, 254, 255, 254, 254, 255, 254, 254, 254, 255, 230, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 230, 255, 255, 255, 254, 255, 254, 255, 254, 255, 254, 255, 254, 254, 254, 255, 254, 254, 255, 255, 254, 254, 255, 230, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 124, 177, 255, 255, 254, 255, 254, 255, 254, 254, 254, 254, 255, 254, 254, 254, 254, 254, 255, 255, 178, 125, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 125, 187, 230, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 230, 187, 124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}, 
{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
};

void drawCenter(){
  ucg.drawLine((ScrW / 2) -110, ScrH / 2, (ScrW / 2) +110, ScrH / 2);
  ucg.drawLine(ScrW / 2, (ScrH / 2) -130, ScrW / 2, (ScrH / 2) +130);
}

void draw_image(int x, int y, int width, int height){
  //int img_size = sizeof(img[1]);
  uint8_t Buffer;

  for (int yy = 0; yy < height; yy += 1) {
    for (int xx = 0; xx < width; xx += 1) {
      Buffer = pgm_read_word(&Chimbalix_Logo[yy][xx]);

      uint8_t color_data = Buffer;
      ucg.setColor( 0, color_data, 0 );
      if ( Buffer != 0 ){
        ucg.drawPixel(xx + x, yy + y);
      }
    }
  }
}

void setup(){
  ucg.begin(UCG_FONT_MODE_TRANSPARENT);
  ucg.setFont(ucg_font_ncenR14_hr);
  ucg.clearScreen();
  //ucg.setRotate180();
  drawCenter();

  //ucg.drawString(20, 270, 0, Chimbalix_Logo[1][1]);
  ucg.drawString(20, 300, 0, "ChiArdumeg v1.0");
  draw_image((ScrW / 2 - 32), (ScrH / 2 - 32), 64, 64);

  urt.InitTouch(PORTRAIT);    // 0,1: PORTRAIT, LANDSCAPE
  urt.setPrecision(PREC_HI);  // 1-4: PREC_LOW, PREC_MEDIUM, PREC_HI, PREC_EXTREME

  ucg.setColor(80, 80, 80); ucg.drawBox(0, 0, 319, 24);
  for (uint8_t i = 1; i < 9; i++) {
    ucg.setColor(255 * (i % 2), 255 * ((i / 2) % 2), 255 * ((i / 4) % 2));
    ucg.drawBox(20 * i, 10, 10, 10);
  }
  ucg.setColor(0, 200, 0); ucg.drawBox(190, 10, 10, 10);
  ucg.setColor(0, 0, 200); ucg.drawBox(210, 10, 10, 10);
}

bool touch_delay_state = 0; uint8_t touch_delay = 50;
bool touch_state = 0;

void loop(){
  while (urt.dataAvailable()) {
    if (touch_delay_state == 0) { delay(touch_delay); touch_delay_state = 1; }

    urt.read();

    xt = urt.getX(); yt = urt.getY();

    if ( touch_state == 0 ) { x = xt; y = yt; cal_xy(); touch_state = 1; }
    else {
      if ( xt < (x+4) && xt > (x-6) ){ x = xt; y = yt; cal_xy(); }
      if ( yt < (y+6) && yt > (y-4) ){ x = xt; y = yt; cal_xy(); }
    }

    if ((x != -1) && (y != -1)) {      
      if (y > 24 && mode == 1) { ucg.drawPixel(x, y); }
      if (y > 28 && mode == 2) { ucg.drawDisc(x, y, 4, 15); }
      if (y < 24 && x < 190) {
        for (uint8_t i = 1; i < 9; i++) {
          if (y < 24 && x > 20 * i - 10 && x < 20 * i + 10) {
            ucg.setColor(255 * (i % 2), 255 * ((i / 2) % 2), 255 * ((i / 4) % 2));
            mode = 1;
          }
        }
      }
      if (y < 24 && x > 190 && x < 200) { mode = 2; }
      if (y < 24 && x > 210) {
        ucg.setColor(0, 0, 0);
        ucg.drawBox(0, 24, 240, 320);
        ucg.setColor(255, 255, 255);
        ucg.setColor(0, 0, 0);
        mode = 1;
      }
    }
  }
  touch_state = 0; touch_delay_state = 0;
}